import{c as ne,j as e,p as O,C as T,g as ce,X as le}from"./index-M9bdpqMz.js";import{h as oe,u as de,b as o}from"./vendor-Chw79xPl.js";import{C as W}from"./chevron-left-Cjdm01Au.js";import{S as me}from"./save-Bvx6sD78.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],ge=ne("upload",ue),fe=()=>{const{id:N}=oe(),h=de(),w=o.useRef(null),[H,F]=o.useState(!0),[d,q]=o.useState(!1),[J,E]=o.useState(!1),[P,u]=o.useState(""),[U,I]=o.useState(!1),[l,Q]=o.useState(null),[g,f]=o.useState({}),[c,_]=o.useState({name:"",price:"",slashed_price:"",description:"",quantity:"",category:""}),[x,A]=o.useState([]),[M,z]=o.useState([]),[p,D]=o.useState([]),$=["serums","moisturizers","bathe and body","sunscreens","toners","face cleansers"],y={maxSize:2*1024*1024,validTypes:["image/jpeg","image/jpg","image/png","image/webp"],maxCount:5},V="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg==",X=a=>a.split(" ").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" "),Y=a=>{if(typeof a=="string"&&a.includes("<br />"))try{const r=a.match(/\{.*\}$/);if(r)return JSON.parse(r[0]);if(a.includes('"code":200')&&a.includes("updated successfully"))return{code:200,message:"Product updated successfully!"}}catch(r){console.warn("Could not parse response JSON:",r)}return a},R=(a=null)=>{f(a?r=>({...r,[a]:""}):{}),P&&u("")},K=a=>y.validTypes.includes(a.type)?a.size>y.maxSize?{valid:!1,error:"File size must be less than 2MB"}:{valid:!0}:{valid:!1,error:"Only JPEG, PNG, and WebP images are allowed"},j=()=>{var a;return l?c.name!==l.name||parseFloat(c.price)!==l.price||parseFloat(c.slashed_price||0)!==(l.slashed_price||0)||c.description!==l.description||parseInt(c.quantity)!==l.available_qty||c.category!==l.category||x.length>0||p.length!==(((a=l.images)==null?void 0:a.length)||0):!1};o.useEffect(()=>{(async()=>{var r,i,t;if(!N){I(!0),F(!1);return}try{const s=await O.fetchProduct(N);if(!s||s.code!==200||!s.product){I(!0);return}const n=s.product;Q(n),_({name:n.name||"",price:((r=n.price)==null?void 0:r.toString())||"",slashed_price:((i=n.slashed_price)==null?void 0:i.toString())||"",category:n.category||"",quantity:((t=n.available_qty)==null?void 0:t.toString())||"",description:n.description||""}),D(Array.isArray(n.images)?n.images:[])}catch(s){console.error("Error fetching product:",s),s.message.includes("not found")||s.status===404?I(!0):s.message.includes("Authentication")?(u("Please log in again to continue."),setTimeout(()=>h("/admin/login"),2e3)):u("Failed to load product data. Please try again.")}finally{F(!1)}})()},[N,h]);const C=a=>{const{name:r,value:i}=a.target;_(t=>({...t,[r]:i})),R(r)},ee=a=>{const r=Array.from(a.target.files);if(p.length+x.length+r.length>y.maxCount){f(s=>({...s,images:`Maximum ${y.maxCount} images allowed per product`}));return}const i=[],t=[];if(r.forEach(s=>{const n=K(s);n.valid?i.push(s):t.push({name:s.name,reason:n.error})}),t.length>0){const s=t.map(n=>`${n.name}: ${n.reason}`).join(", ");f(n=>({...n,images:s}))}i.length>0&&(A(s=>[...s,...i]),i.forEach(s=>{const n=new FileReader;n.onloadend=()=>z(v=>[...v,n.result]),n.readAsDataURL(s)}),g.images&&R("images")),w.current&&(w.current.value="")},G=(a,r)=>{r==="new"?(A(i=>i.filter((t,s)=>s!==a)),z(i=>i.filter((t,s)=>s!==a))):D(i=>i.filter((t,s)=>s!==a))},se=()=>{const a={};return Object.entries({name:{required:!0,minLength:2,message:"Product name is required and must be at least 2 characters"},price:{required:!0,type:"number",min:.01,message:"Please enter a valid price greater than 0"},description:{required:!0,minLength:10,message:"Description is required and must be at least 10 characters"},quantity:{required:!0,type:"integer",min:0,message:"Please enter a valid quantity (0 or greater)"},category:{required:!0,enum:$,message:"Please select a valid category"}}).forEach(([i,t])=>{var n;const s=(n=c[i])==null?void 0:n.trim();if(t.required&&!s){a[i]=t.message;return}s&&(t.minLength&&s.length<t.minLength||t.type==="number"&&(isNaN(s)||parseFloat(s)<(t.min||0))||t.type==="integer"&&(isNaN(s)||parseInt(s)<(t.min||0))||t.enum&&!t.enum.includes(s))&&(a[i]=t.message)}),c.slashed_price&&(isNaN(c.slashed_price)||parseFloat(c.slashed_price)<=0?a.slashed_price="Please enter a valid original price":c.price&&parseFloat(c.slashed_price)<=parseFloat(c.price)&&(a.slashed_price="Original price must be greater than current price")),p.length===0&&x.length===0&&(a.images="At least one product image is required"),f(a),Object.keys(a).length===0},ae=async a=>{var r,i;if(a.preventDefault(),!se()){u("Please correct the errors above and try again.");return}if(!j()){u("No changes detected. Please make some changes before saving.");return}q(!0),u(""),E(!1);try{const t={};c.name!==l.name&&(t.name=c.name.trim()),parseFloat(c.price)!==l.price&&(t.price=parseFloat(c.price)),c.description!==l.description&&(t.description=c.description.trim()),parseInt(c.quantity)!==l.available_qty&&(t.quantity=parseInt(c.quantity,10)),c.category!==l.category&&(t.category=c.category);const s=c.slashed_price?parseFloat(c.slashed_price):null,n=l.slashed_price||null;s!==n&&s&&(t.slashed_price=s),x.length>0&&(t.images=x);const v=await O.updateProduct(N,t),m=Y(v);if(m&&(m.code===200||m.code==="200"))E(!0),setTimeout(()=>{h("/admin/products",{state:{notification:{type:"success",message:`Product "${c.name}" has been updated successfully.`}}})},2e3);else throw new Error((m==null?void 0:m.message)||"Failed to update product")}catch(t){if(console.error("Error updating product:",t),(r=t.message)!=null&&r.includes("Authentication"))u("Please log in again to continue."),setTimeout(()=>h("/admin/login"),2e3);else{const s=t.message||"An error occurred while updating the product.";s==="Failed to update product"&&((i=t.stack)!=null&&i.includes('code":200'))?u("Product may have been updated. Please check the products list to confirm."):u(s)}}finally{q(!1)}},Z=()=>{j()&&!window.confirm("You have unsaved changes. Are you sure you want to leave?")||h("/admin/products")},re=()=>e.jsx("div",{className:"min-h-screen bg-gray-50 py-6",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})})})})}),te=()=>e.jsx("div",{className:"min-h-screen bg-gray-50 py-6",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"bg-white px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("button",{onClick:()=>h("/admin/products"),className:"flex items-center text-gray-600 hover:text-gray-800 mr-4",children:[e.jsx(W,{size:20}),e.jsx("span",{className:"ml-1",children:"Back"})]}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Product Not Found"})]})}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{size:20,className:"mr-3 text-red-500 flex-shrink-0"}),e.jsx("p",{className:"text-red-800",children:"The product you are looking for does not exist or has been removed."})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>h("/admin/products"),className:"px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-md transition-colors",children:"Return to Products"})})]})]})})}),B=({type:a,message:r,submessage:i})=>e.jsx("div",{className:`mb-6 p-4 border rounded-md ${a==="success"?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-center",children:[a==="success"?e.jsx(ce,{size:20,className:"mr-3 text-green-500 flex-shrink-0"}):e.jsx(T,{size:20,className:"mr-3 text-red-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:`${a==="success"?"text-green-800":"text-red-800"} font-medium`,children:r}),i&&e.jsx("p",{className:`${a==="success"?"text-green-700":"text-red-700"} text-sm mt-1`,children:i})]})]})}),b=({label:a,name:r,type:i="text",required:t=!1,placeholder:s,currency:n=!1,rows:v,options:m,className:ie="",...S})=>e.jsxs("div",{className:ie,children:[e.jsxs("label",{htmlFor:r,className:"block text-sm font-medium text-gray-700 mb-2",children:[a," ",t&&e.jsx("span",{className:"text-red-500",children:"*"})]}),i==="select"?e.jsxs("select",{id:r,name:r,value:c[r],onChange:C,disabled:d,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${g[r]?"border-red-300":"border-gray-300"}`,...S,children:[e.jsx("option",{value:"",children:s}),m==null?void 0:m.map(k=>e.jsx("option",{value:k,children:X(k)},k))]}):i==="textarea"?e.jsx("textarea",{id:r,name:r,value:c[r],onChange:C,disabled:d,rows:v||4,className:`w-full px-3 py-2 border rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${g[r]?"border-red-300":"border-gray-300"}`,placeholder:s,...S}):e.jsxs("div",{className:n?"relative":"",children:[n&&e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500",children:"â‚¦"})}),e.jsx("input",{type:i,id:r,name:r,value:c[r],onChange:C,disabled:d,className:`w-full ${n?"pl-8":"pl-3"} pr-3 py-2 border rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${g[r]?"border-red-300":"border-gray-300"}`,placeholder:s,...S})]}),g[r]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:g[r]})]}),L=({images:a,type:r,onRemove:i})=>e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4",children:a.map((t,s)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"aspect-square w-full overflow-hidden rounded-lg bg-gray-100",children:e.jsx("img",{src:t,alt:`${r==="new"?"New":"Product"} image ${s+1}`,className:"h-full w-full object-cover",onError:n=>{n.target.src=V}})}),!d&&e.jsx("button",{type:"button",onClick:()=>i(s,r),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 shadow-lg hover:bg-red-600 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(le,{size:16})}),r==="new"&&e.jsx("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded",children:"New"})]},`${r}-${s}`))});return H?e.jsx(re,{}):U?e.jsx(te,{}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-6",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"bg-white px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("button",{onClick:Z,className:"flex items-center text-gray-600 hover:text-gray-800 mr-4 transition-colors",disabled:d,children:[e.jsx(W,{size:20}),e.jsx("span",{className:"ml-1",children:"Back"})]}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Edit Product"})]})}),e.jsxs("div",{className:"px-6 py-6",children:[J&&e.jsx(B,{type:"success",message:"Product updated successfully!",submessage:"Redirecting to products list..."}),P&&e.jsx(B,{type:"error",message:P}),e.jsxs("form",{onSubmit:ae,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(b,{label:"Product Name",name:"name",required:!0,placeholder:"Enter product name"}),e.jsx(b,{label:"Category",name:"category",type:"select",required:!0,placeholder:"Select Category",options:$}),e.jsx(b,{label:"Price",name:"price",type:"number",required:!0,currency:!0,placeholder:"0.00",min:"0",step:"0.01"}),e.jsx(b,{label:"Original Price (Optional)",name:"slashed_price",type:"number",currency:!0,placeholder:"0.00",min:"0",step:"0.01"}),e.jsx(b,{label:"Quantity",name:"quantity",type:"number",required:!0,placeholder:"Enter available quantity",min:"0",className:"md:col-span-2"}),e.jsx(b,{label:"Description",name:"description",type:"textarea",required:!0,placeholder:"Enter product description",className:"md:col-span-2"}),p.length>0&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["Current Images (",p.length,")"]}),e.jsx(L,{images:p,type:"existing",onRemove:G})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[p.length>0?"Add More Images":"Product Images"," ",p.length===0&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${g.images?"border-red-300 bg-red-50":"border-gray-300 hover:border-gray-400"}`,children:[e.jsx(ge,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"images",className:"cursor-pointer text-blue-600 hover:text-blue-500 font-medium",children:["Choose files",e.jsx("input",{id:"images",name:"images",type:"file",ref:w,className:"hidden",multiple:!0,accept:"image/*",onChange:ee,disabled:d})]}),e.jsx("p",{className:"text-gray-500",children:"or drag and drop"}),e.jsxs("p",{className:"text-sm text-gray-400",children:["PNG, JPG, WebP up to 2MB each (max ",y.maxCount," total)"]})]})]}),g.images&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:g.images}),M.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 mb-3",children:["New Images (",x.length,"):"]}),e.jsx(L,{images:M,type:"new",onRemove:G})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:Z,className:"px-6 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",disabled:d,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:d||!j(),className:`px-6 py-2 border border-transparent rounded-md text-sm font-medium text-white transition-colors ${d||!j()?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:d?e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Updating Product..."]}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(me,{size:18,className:"mr-2"}),"Save Changes",!j()&&e.jsx("span",{className:"ml-2 text-xs",children:"(No changes)"})]})})]})]})]})]})})})};export{fe as default};
//# sourceMappingURL=EditProductPage-CPjD6n7Z.js.map
