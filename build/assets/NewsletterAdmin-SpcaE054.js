import{c as U,h as j,j as e,X as T}from"./index-M9bdpqMz.js";import{b}from"./vendor-Chw79xPl.js";import{M as D}from"./mail-D4TXmlJc.js";import{P as I}from"./plus-CRboUGp0.js";import{R as O}from"./refresh-cw-D7OP5od0.js";import{U as W}from"./users-C5pHbcV-.js";import{C as q}from"./calendar-DQUy51DF.js";import{S as z}from"./search-1ZtBFY2y.js";import{T as R}from"./trash-2-DOtf0Zwe.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],H=U("download",B),K=()=>{const[r,n]=b.useState([]);return{toast:({title:o,description:c,variant:m="default"})=>{const h=Math.random().toString(36).substring(2,9),N={id:h,title:o,description:c,variant:m};n(g=>[...g,N]),setTimeout(()=>{n(g=>g.filter(p=>p.id!==h))},5e3)},toasts:r,removeToast:o=>{n(c=>c.filter(m=>m.id!==o))}}},V=({toast:r,onDismiss:n})=>{const u={default:"bg-white border border-gray-200 text-gray-800",destructive:"bg-red-100 border-red-200 text-red-800",success:"bg-green-100 border-green-200 text-green-800",warning:"bg-yellow-100 border-yellow-200 text-yellow-800"};return e.jsxs("div",{className:`${u[r.variant||"default"]} rounded-md shadow-lg p-4 max-w-xs w-full relative mb-2`,role:"alert",children:[e.jsx("button",{onClick:n,className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700","aria-label":"Dismiss toast",children:e.jsx(T,{className:"w-4 h-4"})}),e.jsx("h3",{className:"font-medium pr-6",children:r.title}),r.description&&e.jsx("p",{className:"text-sm mt-1 pr-6",children:r.description})]})},v={async fetchSubscribers(r=null){var n,u;try{const i={};r&&(i.limit=r);const o=await j.get("/admin/fetch-newsletter-subscribers",{params:i});return((n=o==null?void 0:o.data)==null?void 0:n.code)===200?{success:!0,subscribers:o.data.newsletter_subscribers||[],message:o.data.message||"Subscribers fetched successfully!"}:{success:!1,message:((u=o==null?void 0:o.data)==null?void 0:u.message)||"Failed to fetch subscribers"}}catch(i){return console.error("❌ Newsletter fetch subscribers error:",i),{success:!1,message:i.message||"Network error. Please check your connection and try again."}}},async addSubscriber(r){var n,u;try{if(!r||!r.trim())return{success:!1,message:"Please enter a valid email address"};const i=r.trim();if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i))return{success:!1,message:"Please enter a valid email address"};console.log("🔄 Attempting newsletter subscription for:",i);const c=await j.post(`/newsletter-subscribers/add?email=${encodeURIComponent(i)}`);return((n=c==null?void 0:c.data)==null?void 0:n.code)===200?{success:!0,message:c.data.message||"Successfully subscribed to newsletter!"}:{success:!1,message:((u=c==null?void 0:c.data)==null?void 0:u.message)||"Failed to subscribe. Please try again."}}catch(i){return console.error("❌ Newsletter subscription error:",i),{success:!1,message:i.message||"Network error. Please check your connection and try again."}}},async removeSubscriber(r){var n,u;try{if(!r||!r.trim())return{success:!1,message:"Please enter a valid email address"};const i=r.trim();if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i))return{success:!1,message:"Please enter a valid email address"};console.log("🔄 Attempting newsletter unsubscription for:",i);const c=await j.post(`/newsletter-subscribers/remove?email=${encodeURIComponent(i)}`);return((n=c==null?void 0:c.data)==null?void 0:n.code)===200?{success:!0,message:c.data.message||"Successfully unsubscribed!"}:{success:!1,message:((u=c==null?void 0:c.data)==null?void 0:u.message)||"Failed to unsubscribe. Please try again."}}catch(i){return console.error("❌ Newsletter unsubscribe error:",i),{success:!1,message:i.message||"Network error. Please check your connection and try again."}}}},re=()=>{const[r,n]=b.useState([]),[u,i]=b.useState(!0),[o,c]=b.useState(""),[m,h]=b.useState([]),[N,g]=b.useState(!1),[p,w]=b.useState(""),[S,P]=b.useState({total:0,recent:0,thisMonth:0}),{toast:d,toasts:A,removeToast:F}=K();b.useEffect(()=>{j.getToken()?k():d({title:"Authentication Required",description:"Please login to access this page",variant:"destructive"})},[]);const k=async()=>{i(!0);try{const s=await v.fetchSubscribers();if(s.success){const t=s.subscribers||[];n(t),y(t)}else d({title:"Error",description:s.message||"Failed to fetch subscribers",variant:"destructive"})}catch(s){d({title:"Error",description:s.message||"Failed to fetch subscribers",variant:"destructive"})}finally{i(!1)}},y=s=>{const t=new Date,l=new Date(t.getFullYear(),t.getMonth(),1),a=new Date(t.getTime()-7*24*60*60*1e3);P({total:s.length,recent:s.filter(x=>new Date(x.created_at)>a).length,thisMonth:s.filter(x=>new Date(x.created_at)>l).length})},L=async s=>{if(confirm(`Are you sure you want to remove ${s} from the newsletter?`))try{const t=await v.removeSubscriber(s);if(t.success){n(a=>a.filter(x=>x.email!==s));const l=r.filter(a=>a.email!==s);y(l),d({title:"Success",description:t.message||"Subscriber removed successfully!",variant:"success"})}else d({title:"Error",description:t.message||"Failed to remove subscriber",variant:"destructive"})}catch(t){d({title:"Error",description:t.message||"Failed to remove subscriber",variant:"destructive"})}},M=async()=>{if(m.length===0){d({title:"Warning",description:"Please select subscribers to remove",variant:"warning"});return}if(confirm(`Are you sure you want to remove ${m.length} subscribers?`))try{const s=await Promise.all(m.map(l=>v.removeSubscriber(l)));if(s.every(l=>l.success)){const l=r.filter(a=>!m.includes(a.email));n(l),y(l),h([]),d({title:"Success",description:`${m.length} subscribers removed successfully!`,variant:"success"})}else{const l=s.filter(a=>!a.success).map(a=>a.message);d({title:"Partial Error",description:`Some subscribers could not be removed: ${l.join(", ")}`,variant:"destructive"})}}catch(s){d({title:"Error",description:s.message||"Failed to remove subscribers",variant:"destructive"})}},C=async s=>{if(s.preventDefault(),!p.trim()){d({title:"Warning",description:"Please enter an email address",variant:"warning"});return}if(r.some(t=>t.email.toLowerCase()===p.toLowerCase())){d({title:"Warning",description:"This email is already subscribed",variant:"warning"});return}try{const t=await v.addSubscriber(p);if(t.success){const l={email:p,created_at:new Date().toISOString()},a=[...r,l];n(a),y(a),w(""),g(!1),d({title:"Success",description:t.message||"Subscriber added successfully!",variant:"success"})}else d({title:"Error",description:t.message||"Failed to add subscriber",variant:"destructive"})}catch(t){d({title:"Error",description:t.message||"Failed to add subscriber",variant:"destructive"})}},_=()=>{try{const s=[["Email","Date Subscribed"],...r.map(x=>[x.email,E(x.created_at)])].map(x=>x.join(",")).join(`
`),t=new Blob([s],{type:"text/csv"}),l=window.URL.createObjectURL(t),a=document.createElement("a");a.href=l,a.download=`newsletter_subscribers_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(l),d({title:"Success",description:"Subscribers exported successfully!",variant:"success"})}catch{d({title:"Error",description:"Failed to export subscribers",variant:"destructive"})}},f=r.filter(s=>{var t;return(t=s.email)==null?void 0:t.toLowerCase().includes(o.toLowerCase())}),$=()=>{m.length===f.length&&f.length>0?h([]):h(f.map(s=>s.email))},E=s=>{if(!s)return"Unknown";const t=new Date(s);return isNaN(t.getTime())?"Invalid Date":t.toLocaleDateString()};return u?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-pink-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading subscribers..."})]}):e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-sm min-h-screen bg-gray-50",children:[e.jsx("div",{className:"fixed top-4 right-4 z-50",children:A.map(s=>e.jsx(V,{toast:s,onDismiss:()=>F(s.id)},s.id))}),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(D,{className:"w-6 h-6 text-pink-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Newsletter Subscribers"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center space-x-2 px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Subscriber"})]}),e.jsxs("button",{onClick:_,className:"flex items-center space-x-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{children:"Export CSV"})]}),e.jsxs("button",{onClick:k,className:"flex items-center space-x-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("span",{children:"Refresh"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Total Subscribers"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:S.total})]}),e.jsx(W,{className:"w-8 h-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600",children:"This Month"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:S.thisMonth})]}),e.jsx(q,{className:"w-8 h-8 text-green-500"})]})}),e.jsx("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-600",children:"Last 7 Days"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:S.recent})]}),e.jsx(D,{className:"w-8 h-8 text-purple-500"})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-4 gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search subscribers...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",value:o,onChange:s=>c(s.target.value)})]}),m.length>0&&e.jsxs("button",{onClick:M,className:"flex items-center space-x-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsxs("span",{children:["Remove Selected (",m.length,")"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:e.jsx("input",{type:"checkbox",checked:m.length===f.length&&f.length>0,onChange:$,className:"rounded border-gray-300 text-pink-600 focus:ring-pink-500"})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date Subscribed"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"px-6 py-8 text-center text-gray-500",children:o?"No subscribers found matching your search.":"No subscribers yet."})}):f.map((s,t)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",checked:m.includes(s.email),onChange:l=>{l.target.checked?h(a=>[...a,s.email]):h(a=>a.filter(x=>x!==s.email))},className:"rounded border-gray-300 text-pink-600 focus:ring-pink-500"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:E(s.created_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsx("button",{onClick:()=>L(s.email),className:"text-red-600 hover:text-red-800 transition-colors p-1",title:"Remove subscriber",children:e.jsx(R,{className:"w-5 h-5"})})})]},s.email||t))})]})})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Add New Subscriber"}),e.jsx("button",{onClick:()=>{g(!1),w("")},className:"text-gray-400 hover:text-gray-500",children:e.jsx(T,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),e.jsx("input",{type:"email",id:"email",value:p,onChange:s=>w(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500",placeholder:"Enter email address",onKeyPress:s=>{s.key==="Enter"&&(s.preventDefault(),C(s))}})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>{g(!1),w("")},className:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:C,className:"px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500",children:"Add Subscriber"})]})]})]})})]})]})};export{re as default};
//# sourceMappingURL=NewsletterAdmin-SpcaE054.js.map
