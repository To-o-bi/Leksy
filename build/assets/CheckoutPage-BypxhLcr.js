import{b as F,j as e}from"./index-M9bdpqMz.js";import{u as q,b as x,L as k}from"./vendor-Chw79xPl.js";import{B as E}from"./Breadcrumb-rFEQV4Cz.js";import{B as $}from"./Button-DZKEEeFG.js";import{N as A}from"./Notification-SFVOOW3C.js";const I="https://leksycosmetics.com",h=s=>`₦${parseFloat(s).toLocaleString("en-NG",{minimumFractionDigits:2,maximumFractionDigits:2})}`,O=s=>s.map(i=>({product_id:i.id,quantity:i.quantity})),R=(s,i)=>{const o={};return s.name.trim()||(o.name="Name is required"),s.email.trim()?/\S+@\S+\.\S+/.test(s.email)||(o.email="Email is invalid"):o.email="Email is required",s.phone.trim()||(o.phone="Phone number is required"),i==="address"&&(s.state.trim()||(o.state="State is required"),s.city.trim()||(o.city="City is required"),s.street_address.trim()||(o.street_address="Street address is required")),s.agreeToTerms||(o.agreeToTerms="You must agree to the terms and conditions"),o},B=async(s,i,o,u)=>{var m;try{const c=O(o),r=new FormData;r.append("name",s.name.trim()),r.append("email",s.email.trim()),r.append("phone",s.phone.trim()),r.append("delivery_method",i),r.append("cart",JSON.stringify(c)),r.append("success_redirect",u),i==="address"?(r.append("state",s.state.trim()),r.append("city",s.city.trim()),r.append("street_address",s.street_address.trim())):(r.append("state","FCT"),r.append("city","Store Pickup"),r.append("street_address","Store Pickup - No Address Required")),s.notes&&s.notes.trim()&&r.append("notes",s.notes.trim());const g=`${I}/api/checkout/initiate`;console.log("Initiating checkout with URL:",g),console.log("Request data:",{name:s.name.trim(),email:s.email.trim(),phone:s.phone.trim(),delivery_method:i,state:i==="address"?s.state.trim():"FCT",city:i==="address"?s.city.trim():"Store Pickup",street_address:i==="address"?s.street_address.trim():"Store Pickup - No Address Required",cart:JSON.stringify(c),success_redirect:u,notes:((m=s.notes)==null?void 0:m.trim())||""});const d=await fetch(g,{method:"POST",body:r});if(!d.ok){const l=await d.text();throw console.error("API Error Response:",l),new Error(`HTTP error! status: ${d.status} - ${l}`)}const b=await d.json();return console.log("API Response:",b),b}catch(c){throw console.error("Checkout initiation error:",c),c}},L=(s,i,o,u,m,c)=>{window.pendingOrderDetails={customerInfo:{name:s.name,email:s.email,phone:s.phone},deliveryInfo:{method:i,address:i==="address"?s.street_address:"Store Pickup",city:i==="address"?s.city:"N/A",state:i==="address"?s.state:"N/A"},orderSummary:{items:o,subtotal:u,shipping:m,total:c},notes:s.notes||""}},K=["Abia","Adamawa","Akwa Ibom","Anambra","Bauchi","Bayelsa","Benue","Borno","Cross River","Delta","Ebonyi","Edo","Ekiti","Enugu","FCT","Gombe","Imo","Jigawa","Kaduna","Kano","Katsina","Kebbi","Kogi","Kwara","Lagos","Nasarawa","Niger","Ogun","Ondo","Osun","Oyo","Plateau","Rivers","Sokoto","Taraba","Yobe","Zamfara"],Y=s=>s==="pickup"?0:5e3,U=()=>`${window.location.origin}/checkout/checkout-success`,W=()=>{const{cart:s,totalPrice:i,clearCart:o}=F(),u=q(),[m,c]=x.useState(null),[r,g]=x.useState(!1),[d,b]=x.useState("address"),[l,w]=x.useState({name:"",email:"",phone:"",state:"",city:"",street_address:"",notes:"",agreeToTerms:!1}),[a,j]=x.useState({}),N=Y(d),f=i+N,C=U();x.useEffect(()=>{s.length===0&&u("/cart")},[s,u]);const p=t=>{const{name:n,value:T,type:_,checked:P}=t.target;w({...l,[n]:_==="checkbox"?P:T}),a[n]&&j({...a,[n]:""})},y=t=>{if(b(t),t==="pickup"){const n={...a};delete n.state,delete n.city,delete n.street_address,j(n)}},S=()=>{const t=R(l,d);return j(t),Object.keys(t).length===0},v=async t=>{if(t.preventDefault(),!S()){c({type:"error",message:"Please fill in all required fields correctly"});return}try{g(!0);const n=await B(l,d,s,C);if(n.code===200&&n.authorization_url)L(l,d,s,i,N,f),c({type:"success",message:"Redirecting to payment gateway..."}),o(),setTimeout(()=>{window.location.href=n.authorization_url},1e3);else throw new Error(n.message||"Failed to initiate checkout")}catch(n){console.error("Checkout initiation error:",n),c({type:"error",message:n.message||"Failed to initiate checkout. Please try again."})}finally{g(!1)}};return x.useEffect(()=>{if(m){const t=setTimeout(()=>{c(null)},5e3);return()=>clearTimeout(t)}},[m]),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[m&&e.jsx(A,{type:m.type,message:m.message,onClose:()=>c(null)}),e.jsx(E,{items:[{label:"Home",path:"/"},{label:"Cart",path:"/cart"},{label:"Checkout",path:"/checkout"}]}),e.jsx("h1",{className:"text-3xl font-bold mb-8 text-center text-gray-800",children:"Checkout"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-6",children:"Delivery Method"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:`border-2 rounded-lg p-4 cursor-pointer transition-colors ${d==="address"?"border-pink-500 bg-pink-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>y("address"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"deliveryMethod",value:"address",checked:d==="address",onChange:()=>y("address"),className:"h-4 w-4 text-pink-600 focus:ring-pink-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Home Delivery"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Delivery to your address (",h(5e3),")"]})]})]})}),e.jsx("div",{className:`border-2 rounded-lg p-4 cursor-pointer transition-colors ${d==="pickup"?"border-pink-500 bg-pink-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>y("pickup"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"deliveryMethod",value:"pickup",checked:d==="pickup",onChange:()=>y("pickup"),className:"h-4 w-4 text-pink-600 focus:ring-pink-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:"Store Pickup"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Pick up from our store (Free)"})]})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-6",children:"Customer Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:["Full Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:l.name,onChange:p,className:`w-full px-4 py-2 border rounded-md focus:ring-pink-500 focus:border-pink-500 ${a.name?"border-red-500":"border-gray-300"}`,placeholder:"Your full name",disabled:r,required:!0}),a.name&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.name})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",id:"email",name:"email",value:l.email,onChange:p,className:`w-full px-4 py-2 border rounded-md focus:ring-pink-500 focus:border-pink-500 ${a.email?"border-red-500":"border-gray-300"}`,placeholder:"your@email.com",disabled:r,required:!0}),a.email&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.email})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:l.phone,onChange:p,className:`w-full px-4 py-2 border rounded-md focus:ring-pink-500 focus:border-pink-500 ${a.phone?"border-red-500":"border-gray-300"}`,placeholder:"+234 8012345678",disabled:r,required:!0}),a.phone&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.phone})]})]})]}),d==="address"&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-6",children:"Delivery Address"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"state",className:"block text-sm font-medium text-gray-700 mb-1",children:["State ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"state",name:"state",value:l.state,onChange:p,className:`w-full px-4 py-2 border rounded-md focus:ring-pink-500 focus:border-pink-500 ${a.state?"border-red-500":"border-gray-300"}`,disabled:r,required:!0,children:[e.jsx("option",{value:"",children:"Select State"}),K.map(t=>e.jsx("option",{value:t,children:t},t))]}),a.state&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.state})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700 mb-1",children:["City ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"city",name:"city",value:l.city,onChange:p,className:`w-full px-4 py-2 border rounded-md focus:ring-pink-500 focus:border-pink-500 ${a.city?"border-red-500":"border-gray-300"}`,placeholder:"Your city",disabled:r,required:!0}),a.city&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.city})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{htmlFor:"street_address",className:"block text-sm font-medium text-gray-700 mb-1",children:["Street Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"street_address",name:"street_address",value:l.street_address,onChange:p,className:`w-full px-4 py-2 border rounded-md focus:ring-pink-500 focus:border-pink-500 ${a.street_address?"border-red-500":"border-gray-300"}`,placeholder:"Your full address",disabled:r,required:!0}),a.street_address&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.street_address})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-6",children:"Additional Info"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Order Notes (Optional)"}),e.jsx("textarea",{id:"notes",name:"notes",value:l.notes,onChange:p,rows:"4",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-pink-500 focus:border-pink-500",placeholder:"Notes about your order, e.g. special delivery instructions",disabled:r})]})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-6",children:"Order Summary"}),e.jsx("div",{className:"space-y-4 mb-6",children:s.map(t=>{var n;return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-md overflow-hidden flex-shrink-0",children:e.jsx("img",{src:t.image,alt:t.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-800",children:[t.name," ",t.quantity>1&&`x${t.quantity}`]}),t.variant&&e.jsx("div",{className:"text-xs text-gray-500",children:t.variant.name})]}),e.jsx("div",{className:"text-sm font-medium text-gray-800",children:h(t.price*t.quantity)})]},`${t.id}-${((n=t.variant)==null?void 0:n.id)||"default"}`)})}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4 mb-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),e.jsx("span",{className:"font-medium",children:h(i)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:d==="pickup"?"Pickup:":"Shipping:"}),e.jsx("span",{className:"font-medium",children:d==="pickup"?"Free":h(N)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-semibold pt-2 border-t border-gray-200",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"text-pink-600",children:h(f)})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Your personal data will be used to process your order, support your experience throughout this website, and for other purposes described in our"," ",e.jsx(k,{to:"/privacy-policy",className:"text-pink-500 hover:text-pink-600",children:"privacy policy"}),"."]}),e.jsxs("div",{className:"flex items-start mb-6",children:[e.jsx("input",{type:"checkbox",id:"agreeToTerms",name:"agreeToTerms",checked:l.agreeToTerms,onChange:p,className:`mt-1 mr-2 h-4 w-4 text-pink-600 focus:ring-pink-500 border-gray-300 rounded ${a.agreeToTerms?"border-red-500":""}`,disabled:r,required:!0}),e.jsxs("label",{htmlFor:"agreeToTerms",className:"text-sm text-gray-600",children:["I have read and agree to the website"," ",e.jsx(k,{to:"/terms",className:"text-pink-500 hover:text-pink-600",children:"terms and conditions"})," ",e.jsx("span",{className:"text-red-500",children:"*"})]})]}),a.agreeToTerms&&e.jsx("p",{className:"mt-1 text-sm text-red-500 mb-4",children:a.agreeToTerms}),e.jsx($,{type:"submit",onClick:v,disabled:r,className:`w-full py-3 rounded-md font-medium transition-colors ${r?"bg-gray-400 cursor-not-allowed text-gray-200":"bg-pink-500 hover:bg-pink-600 text-white"}`,children:r?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Initiating Payment..."]}):`Proceed to Payment - ${h(f)}`})]}),e.jsxs(k,{to:"/cart",className:"flex items-center justify-center text-pink-500 hover:text-pink-600",children:[e.jsx("span",{className:"mr-1",children:"«"})," Back to Cart"]})]})})]})]})};export{W as default};
//# sourceMappingURL=CheckoutPage-BypxhLcr.js.map
