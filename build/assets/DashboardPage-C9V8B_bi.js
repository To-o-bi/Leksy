import{c as v,u as I,o as L,p as F,f as T,j as e}from"./index-M9bdpqMz.js";import{b as N,u as U}from"./vendor-Chw79xPl.js";import{R as _}from"./refresh-cw-D7OP5od0.js";import{S as C}from"./shopping-bag-DxIaoviK.js";import{U as z}from"./users-C5pHbcV-.js";import{C as E}from"./clock-Clwfga92.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],q=v("arrow-down",$);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],Y=v("arrow-up-right",H);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],k=v("arrow-up",B);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],W=v("dollar-sign",V),J=({dashboardData:o,isLoading:m})=>{const x=d=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN",minimumFractionDigits:0}).format(d||0);return m?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(d=>e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm animate-pulse",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-16"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})]}),e.jsx("div",{className:"h-12 w-12 bg-gray-200 rounded-full"})]})},d))}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Orders"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:o.totalOrders.toLocaleString()}),e.jsxs("div",{className:"flex items-center text-sm mt-3",children:[e.jsxs("span",{className:"text-green-600 flex items-center font-medium",children:[e.jsx(k,{size:16,className:"mr-1"}),o.orderGrowth,"%"]}),e.jsx("span",{className:"text-gray-500 ml-2",children:"vs last month"})]})]}),e.jsx("div",{className:"bg-blue-100 p-3 rounded-full",children:e.jsx(C,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border-l-4 border-green-500",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Sales"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:x(o.totalSales)}),e.jsxs("div",{className:"flex items-center text-sm mt-3",children:[e.jsxs("span",{className:"text-green-600 flex items-center font-medium",children:[e.jsx(k,{size:16,className:"mr-1"}),o.salesGrowth,"%"]}),e.jsx("span",{className:"text-gray-500 ml-2",children:"vs last month"})]})]}),e.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:e.jsx(W,{className:"h-6 w-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border-l-4 border-purple-500",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Products"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:o.totalProducts.toLocaleString()}),e.jsxs("div",{className:"flex items-center text-sm mt-3",children:[e.jsxs("span",{className:"text-blue-600 flex items-center font-medium",children:[e.jsx(k,{size:16,className:"mr-1"}),o.productGrowth,"%"]}),e.jsx("span",{className:"text-gray-500 ml-2",children:"new this month"})]})]}),e.jsx("div",{className:"bg-purple-100 p-3 rounded-full",children:e.jsx(z,{className:"h-6 w-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border-l-4 border-orange-500",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Orders"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:o.pendingOrders}),e.jsx("div",{className:"flex items-center text-sm mt-3",children:e.jsxs("span",{className:"text-orange-600 flex items-center font-medium",children:[e.jsx(E,{size:16,className:"mr-1"}),"Needs attention"]})})]}),e.jsx("div",{className:"bg-orange-100 p-3 rounded-full",children:e.jsx(E,{className:"h-6 w-6 text-orange-600"})})]})})]})},K=({orders:o,isLoading:m,onRefresh:x})=>{const d=U(),c=t=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN",minimumFractionDigits:0}).format(t||0),A=t=>{try{return new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return t||"N/A"}},O=t=>{switch(t==null?void 0:t.toLowerCase()){case"successful":case"completed":case"delivered":return"bg-green-100 text-green-800 border-green-200";case"pending":case"order-received":case"unpaid":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"processing":case"packaged":case"in-transit":return"bg-blue-100 text-blue-800 border-blue-200";case"cancelled":case"failed":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return m?e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Recent Orders"})}),e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(t=>e.jsxs("div",{className:"animate-pulse flex space-x-4 py-4 border-b border-gray-100",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded-full w-20"})]},t))})]}):e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Recent Orders"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:x,className:"text-sm flex items-center text-gray-600 hover:text-gray-900 px-3 py-2 rounded-lg hover:bg-gray-100",children:[e.jsx(_,{size:16,className:"mr-1"}),"Refresh"]}),e.jsxs("button",{onClick:()=>d("/admin/orders"),className:"text-sm flex items-center text-blue-600 hover:text-blue-800 px-3 py-2 rounded-lg hover:bg-blue-50",children:["View all ",e.jsx(Y,{size:16,className:"ml-1"})]})]})]}),o.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(C,{size:64,className:"mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No orders yet"}),e.jsx("p",{className:"text-gray-500",children:"Orders will appear here once customers start purchasing."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-4 text-sm font-semibold text-gray-700",children:"ORDER ID"}),e.jsx("th",{className:"text-left py-4 text-sm font-semibold text-gray-700",children:"CUSTOMER"}),e.jsx("th",{className:"text-left py-4 text-sm font-semibold text-gray-700",children:"EMAIL"}),e.jsx("th",{className:"text-left py-4 text-sm font-semibold text-gray-700",children:"AMOUNT"}),e.jsx("th",{className:"text-left py-4 text-sm font-semibold text-gray-700",children:"DATE"}),e.jsx("th",{className:"text-left py-4 text-sm font-semibold text-gray-700",children:"STATUS"})]})}),e.jsx("tbody",{children:o.slice(0,10).map((t,b)=>e.jsxs("tr",{className:"border-b border-gray-50 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"py-4 text-sm font-mono text-blue-600",children:["#",t.id||"N/A"]}),e.jsx("td",{className:"py-4 text-sm font-medium text-gray-900",children:t.name||"Unknown Customer"}),e.jsx("td",{className:"py-4 text-sm text-gray-600",children:t.email||"N/A"}),e.jsx("td",{className:"py-4 text-sm font-semibold text-gray-900",children:c(t.amount)}),e.jsx("td",{className:"py-4 text-sm text-gray-600",children:A(t.date)}),e.jsx("td",{className:"py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium border ${O(t.status)}`,children:t.status||"Unknown"})})]},t.id||b))})]})})]})},ae=()=>{const o=I(),[m,x]=N.useState(!0),[d,c]=N.useState(null),[A,O]=N.useState({totalOrders:0,totalSales:0,totalProducts:0,pendingOrders:0,orderGrowth:0,salesGrowth:0,productGrowth:0}),[t,b]=N.useState([]),j=r=>{var y,l,n,i,h,g,p;return r.isAPILevel401||((y=r.response)==null?void 0:y.status)===401||((n=(l=r.response)==null?void 0:l.data)==null?void 0:n.code)===401||((i=r.message)==null?void 0:i.includes("Admin authentication required"))?(console.log("🚨 Auth error detected in dashboard, but NOT auto-logging out"),console.log("🔍 Error details:",{message:r.message,status:(h=r.response)==null?void 0:h.status,apiCode:(p=(g=r.response)==null?void 0:g.data)==null?void 0:p.code,hasToken:!!api.getToken()}),!0):!1};N.useEffect(()=>{w()},[]);const w=async()=>{var r,S,y;try{x(!0),c(null),console.log("Fetching dashboard data...");const[l,n]=await Promise.allSettled([L.fetchOrders({limit:50}),F.fetchProducts({limit:1e3})]);if(console.log("Orders response:",l),console.log("Products response:",n),l.status==="rejected"&&j(l.reason)||n.status==="rejected"&&j(n.reason))return;let i=[],h=0,g=0;if(l.status==="fulfilled"){const a=l.value;console.log("Orders result:",a),(a==null?void 0:a.code)===200&&a.orders?(i=a.orders,console.log("Orders data:",i),i.forEach(s=>{const f=parseFloat(s.amount_paid||s.amount_calculated||s.total_amount||0);h+=f;const R=(s.delivery_status||s.order_status||"").toLowerCase();["pending","order-received","unpaid","flagged"].includes(R)&&g++}),b(i.map(s=>({id:s.order_id||s.id||"N/A",name:s.name||s.customer_name||"Unknown Customer",email:s.email||s.customer_email||"N/A",amount:parseFloat(s.amount_paid||s.amount_calculated||s.total_amount||0),date:s.created_at||s.order_date||new Date().toISOString(),status:s.order_status||s.delivery_status||"unknown"})).sort((s,f)=>new Date(f.date)-new Date(s.date)))):console.log("Orders API returned unexpected format:",a)}else{console.error("Orders fetch failed:",((r=l.reason)==null?void 0:r.message)||l.reason);const a=j(l.reason);c(a?"Authentication issue detected. You may need to log in again.":((S=l.reason)==null?void 0:S.message)||"Failed to fetch orders")}let p=0;if(n.status==="fulfilled"){const a=n.value;console.log("Products result:",a),(a==null?void 0:a.code)===200&&a.products?p=a.products.length:console.log("Products API returned unexpected format:",a)}else{console.error("Products fetch failed:",((y=n.reason)==null?void 0:y.message)||n.reason);const a=j(n.reason);c(a?s=>s||"Authentication issue detected. You may need to log in again.":s=>{var f;return s||((f=n.reason)==null?void 0:f.message)||"Failed to fetch products"})}const P=Math.floor(Math.random()*25)+5,M=Math.floor(Math.random()*20)+3,G=Math.floor(Math.random()*15)+1;O({totalOrders:i.length,totalSales:h,totalProducts:p,pendingOrders:g,orderGrowth:P,salesGrowth:M,productGrowth:G}),console.log("Dashboard data updated:",{totalOrders:i.length,totalSales:h,totalProducts:p,pendingOrders:g})}catch(l){console.error("Error fetching dashboard data:",l);const n=j(l);c(n?"Authentication issue detected. You may need to log in again.":l.message||"Failed to load dashboard data")}finally{x(!1)}},u=T.getAuthUser(),D=(u==null?void 0:u.name)||(u==null?void 0:u.username)||"Admin";if(d){const r=d.includes("Authentication issue");return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:`border rounded-xl p-6 ${r?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:`p-2 rounded-full mr-3 ${r?"bg-yellow-100":"bg-red-100"}`,children:e.jsx(q,{className:`h-5 w-5 ${r?"text-yellow-600":"text-red-600"}`})}),e.jsx("h3",{className:`text-lg font-semibold ${r?"text-yellow-800":"text-red-800"}`,children:r?"Authentication Issue":"Error Loading Dashboard"})]}),e.jsx("p",{className:`mb-4 ${r?"text-yellow-600":"text-red-600"}`,children:d}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:w,className:`px-4 py-2 rounded-lg transition-colors flex items-center ${r?"bg-yellow-600 text-white hover:bg-yellow-700":"bg-red-600 text-white hover:bg-red-700"}`,children:[e.jsx(_,{size:16,className:"mr-2"}),"Try Again"]}),r&&e.jsx("button",{onClick:()=>o.logout("Manual logout",!0),className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"Log Out & Sign In Again"})]})]})})}return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:["Welcome back, ",D,"!"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Here's what's happening with your store today."})]}),e.jsx("button",{onClick:w,className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors flex items-center shadow-sm",disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{size:16,className:"mr-2"}),"Refresh Data"]})})]}),e.jsx(J,{dashboardData:A,isLoading:m}),e.jsx(K,{orders:t,isLoading:m,onRefresh:w})]})};export{ae as default};
//# sourceMappingURL=DashboardPage-C9V8B_bi.js.map
