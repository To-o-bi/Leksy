import{c as W,u as X,o as z,j as e,C as Z}from"./index-M9bdpqMz.js";import{b as r}from"./vendor-Chw79xPl.js";import{R as ee}from"./refresh-cw-D7OP5od0.js";import{S as se}from"./search-1ZtBFY2y.js";import{E as ae}from"./eye-C17Yuevi.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],re=W("funnel",te),oe=()=>{var q;const{isAuthenticated:n,user:m,isAdmin:u}=X(),[x,D]=r.useState([]),[h,w]=r.useState(!0),[c,S]=r.useState(null),[o,v]=r.useState(1),[f,P]=r.useState("successful"),[b,_]=r.useState("all"),[g,R]=r.useState(""),[l,M]=r.useState(null),[G,O]=r.useState(!1),[y,k]=r.useState(null),[V,T]=r.useState(!1),C=9,Y=r.useMemo(()=>[{value:"successful",label:"Successful Orders"},{value:"unsuccessful",label:"Failed Orders"},{value:"flagged",label:"Flagged Orders"},{value:"all",label:"All Payment Status"}],[]),B=r.useMemo(()=>[{value:"all",label:"All Delivery Status"},{value:"delivered",label:"Delivered"},{value:"in-transit",label:"In Transit"},{value:"packaged",label:"Packaged"},{value:"order-received",label:"Order Received"},{value:"unpaid",label:"Unpaid"}],[]),Q=r.useMemo(()=>[{value:"unpaid",label:"Unpaid"},{value:"order-received",label:"Order Received"},{value:"packaged",label:"Packaged"},{value:"in-transit",label:"In Transit"},{value:"delivered",label:"Delivered"}],[]),A=r.useCallback(s=>s?new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN",minimumFractionDigits:0,maximumFractionDigits:0}).format(s):"â‚¦0",[]),L=r.useCallback(s=>{if(!s)return"Unknown";try{return new Date(s).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}catch{return"Invalid Date"}},[]),j=r.useCallback(s=>({successful:"bg-green-100 text-green-600",delivered:"bg-green-100 text-green-600","order-received":"bg-orange-100 text-orange-600",pending:"bg-orange-100 text-orange-600",packaged:"bg-blue-100 text-blue-600","in-transit":"bg-purple-100 text-purple-600",failed:"bg-red-100 text-red-600",cancelled:"bg-red-100 text-red-600",unpaid:"bg-gray-100 text-gray-600"})[s==null?void 0:s.toLowerCase()]||"bg-gray-100 text-gray-600",[]),I=r.useCallback(()=>{if(!n||!m)throw new Error("Admin authentication required to view orders. Please log in as admin.");if(!u)throw new Error("Admin privileges required to view orders.")},[n,m,u]),E=r.useCallback((s,a)=>{k({type:s,message:a})},[]),F=r.useCallback(s=>s.map(a=>({id:a.order_id,name:a.name,email:a.email,phone:a.phone,amount:a.amount_paid||a.amount_calculated||0,date:L(a.created_at),rawDate:a.created_at,orderStatus:a.order_status,deliveryStatus:a.delivery_status,deliveryMethod:a.delivery_method,address:a.street_address?`${a.street_address}, ${a.city}, ${a.state}`:"Pickup",state:a.state,city:a.city,streetAddress:a.street_address,cart:a.cart_obj||[],rawData:a})),[L]),N=r.useCallback(async()=>{var s;try{if(w(!0),S(null),!n||!m)throw new Error("Admin authentication required to view orders. Please log in as admin.");if(!u)throw new Error("Admin privileges required to view orders.");console.log("ðŸ”„ Fetching orders with auth check passed");const a={};f!=="all"&&(a.order_status=f),b!=="all"&&(a.delivery_status=b),a.limit=200,console.log("ðŸ“¡ Calling orderService.fetchOrders with filters:",a);const t=await z.fetchOrders(a);if(console.log("âœ… Orders fetch result:",{code:t==null?void 0:t.code,message:t==null?void 0:t.message,productsCount:((s=t==null?void 0:t.products)==null?void 0:s.length)||0}),(t==null?void 0:t.code)===200){const i=F(t.orders||[]);D(i),console.log(`âœ… Successfully loaded ${i.length} orders`)}else throw new Error((t==null?void 0:t.message)||"Failed to fetch orders")}catch(a){console.error("âŒ Error fetching orders:",a);let t="Failed to load orders";a.message.includes("CORS")?t="CORS error: The server needs to allow requests from this domain. Please contact your backend administrator.":a.message.includes("Network connection failed")||a.message.includes("Failed to fetch")?t="Network connection failed. Please check your internet connection and ensure the API server is running.":a.message.includes("precondition")||a.message.includes("Unauthorized")||a.message.includes("401")?t="Session expired. Please log in again as admin.":a.message.includes("Authentication")||a.message.includes("Admin")?t=a.message:a.message.includes("403")?t="Access forbidden. Admin privileges required.":a.message&&(t=a.message),S(t)}finally{w(!1)}},[f,b,n,m,u,F]),H=r.useCallback(async(s,a)=>{try{T(!0),I(),console.log("ðŸ”„ Updating delivery status:",{orderId:s,newStatus:a}),await z.changeDeliveryStatus(s,a),D(t=>t.map(i=>i.id===s?{...i,deliveryStatus:a}:i)),(l==null?void 0:l.id)===s&&M(t=>({...t,deliveryStatus:a})),E("success",`Status updated to "${a}" successfully`)}catch(t){console.error("âŒ Error updating delivery status:",t);let i="Failed to update delivery status";t.message.includes("precondition")||t.message.includes("Unauthorized")||t.message.includes("Authentication")||t.message.includes("Admin")?i="Admin authentication required. Please ensure you are logged in as an admin.":t.message&&(i=t.message),E("error",i)}finally{T(!1)}},[I,l,E]),p=r.useMemo(()=>{if(!g.trim())return x;const s=g.toLowerCase();return x.filter(a=>{var t,i,$,U;return((t=a.id)==null?void 0:t.toLowerCase().includes(s))||((i=a.name)==null?void 0:i.toLowerCase().includes(s))||(($=a.email)==null?void 0:$.toLowerCase().includes(s))||((U=a.phone)==null?void 0:U.toLowerCase().includes(s))})},[x,g]),d=r.useMemo(()=>{const s=Math.ceil(p.length/C),a=o*C,t=a-C,i=p.slice(t,a);return{totalPages:s,indexOfFirstOrder:t,indexOfLastOrder:Math.min(a,p.length),currentOrders:i}},[p,o]),J=r.useCallback(()=>{P("successful"),_("all"),R(""),v(1)},[]),K=r.useCallback(s=>{M(s),O(!0)},[]);if(r.useEffect(()=>{if(y){const s=setTimeout(()=>k(null),5e3);return()=>clearTimeout(s)}},[y]),r.useEffect(()=>{n&&m?N():(w(!1),S("Admin authentication required to view orders. Please log in as admin."))},[N,n,m]),r.useEffect(()=>{v(1)},[g,f,b]),h&&x.length===0)return e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-48 mb-6"}),e.jsx("div",{className:"space-y-4",children:Array.from({length:5},(s,a)=>e.jsx("div",{className:"h-12 bg-gray-200 rounded w-full"},a))})]})});if(c&&x.length===0){const s=c.includes("authentication")||c.includes("Admin")||c.includes("Session expired"),a=c.includes("CORS"),t=c.includes("Network connection failed");return e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Z,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:s?"Authentication Required":a?"Server Configuration Issue":t?"Connection Problem":"Error Loading Orders"}),e.jsx("p",{className:"text-gray-600 mb-4 max-w-md mx-auto",children:c}),e.jsx("div",{className:"flex gap-2 justify-center flex-wrap",children:s?e.jsx("button",{onClick:()=>window.location.href="/admin/login",className:"bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600",children:"Go to Login"}):a?e.jsxs("div",{className:"text-sm text-gray-500 max-w-md",children:[e.jsx("p",{className:"mb-2",children:"This error needs to be fixed by your backend administrator."}),e.jsx("p",{children:"The server needs to add CORS headers to allow requests from this domain."})]}):e.jsx("button",{onClick:N,disabled:h,className:"bg-pink-500 text-white px-6 py-2 rounded-md hover:bg-pink-600 disabled:opacity-50",children:h?"Retrying...":"Try Again"})}),!1]})})}return e.jsxs("div",{className:"space-y-6",children:[y&&e.jsx("div",{className:`fixed top-4 right-4 p-4 rounded-md shadow-lg z-50 ${y.type==="success"?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:y.message}),e.jsx("button",{onClick:()=>k(null),className:"ml-4 text-xl hover:opacity-70",children:"Ã—"})]})}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800",children:"All Orders"}),e.jsx("p",{className:"text-gray-600 mt-1",children:h?"Loading...":`${p.length} of ${x.length} orders`})]}),e.jsxs("button",{onClick:N,className:"bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded-md flex items-center transition-colors",disabled:h,children:[e.jsx(ee,{className:`h-4 w-4 mr-2 ${h?"animate-spin":""}`}),"Refresh"]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by order ID, customer name, email, or phone...",value:g,onChange:s=>R(s.target.value),className:"pl-10 pr-4 py-2 w-full border border-gray-200 rounded-md focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition-colors"})]}),e.jsxs("div",{className:"flex gap-4 items-center flex-wrap",children:[e.jsxs("div",{className:"flex border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"p-3 bg-gray-50 border-r border-gray-200",children:e.jsx(re,{className:"h-5 w-5 text-gray-500"})}),e.jsx("div",{className:"px-4 py-2 bg-gray-50",children:e.jsx("span",{className:"text-sm font-medium",children:"Filter By"})})]}),e.jsx("select",{className:"bg-gray-50 border border-gray-200 rounded-lg py-2 px-4 text-sm transition-colors hover:bg-gray-100",value:f,onChange:s=>P(s.target.value),children:Y.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx("select",{className:"bg-gray-50 border border-gray-200 rounded-lg py-2 px-4 text-sm transition-colors hover:bg-gray-100",value:b,onChange:s=>_(s.target.value),children:B.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsx("button",{className:"px-4 py-2 rounded-lg text-pink-500 hover:bg-pink-50 transition-colors",onClick:J,children:"Reset Filter"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-200",children:["ORDER ID","CUSTOMER","AMOUNT","DATE","PAYMENT","DELIVERY","ACTION"].map(s=>e.jsx("th",{className:"pb-3 text-sm font-medium text-gray-500 uppercase",children:s},s))})}),e.jsx("tbody",{children:d.currentOrders.length>0?d.currentOrders.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"py-4 text-sm font-mono",children:s.id}),e.jsx("td",{className:"py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.email}),e.jsx("div",{className:"text-xs text-gray-500",children:s.phone})]})}),e.jsx("td",{className:"py-4 text-sm font-semibold",children:A(s.amount)}),e.jsx("td",{className:"py-4 text-sm",children:s.date}),e.jsx("td",{className:"py-4",children:e.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${j(s.orderStatus)}`,children:s.orderStatus})}),e.jsx("td",{className:"py-4",children:e.jsx("select",{value:s.deliveryStatus,onChange:a=>H(s.id,a.target.value),disabled:V||!n||!u,className:`text-xs px-2 py-1 rounded-full border-0 cursor-pointer font-medium transition-colors ${j(s.deliveryStatus)} ${!n||!u?"opacity-50 cursor-not-allowed":"hover:opacity-80"}`,children:Q.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})}),e.jsx("td",{className:"py-4",children:e.jsxs("button",{className:"text-pink-500 border border-pink-500 rounded-lg px-4 py-2 text-sm hover:bg-pink-50 flex items-center transition-colors",onClick:()=>K(s),children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"View Details"]})})]},s.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"py-12 text-center text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“¦"}),e.jsx("p",{className:"text-lg font-medium",children:"No orders found"}),g&&e.jsx("p",{className:"text-sm mt-2",children:"Try adjusting your search or filters"})]})})})]})}),d.totalPages>1&&e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",d.indexOfFirstOrder+1,"-",d.indexOfLastOrder," of ",p.length," orders"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>v(Math.max(1,o-1)),disabled:o===1,className:"h-8 w-8 flex justify-center items-center rounded border border-gray-200 disabled:opacity-50 hover:bg-gray-50 transition-colors",children:"â€¹"}),e.jsxs("span",{className:"text-sm px-2",children:["Page ",o," of ",d.totalPages]}),e.jsx("button",{onClick:()=>v(Math.min(d.totalPages,o+1)),disabled:o===d.totalPages,className:"h-8 w-8 flex justify-center items-center rounded border border-gray-200 disabled:opacity-50 hover:bg-gray-50 transition-colors",children:"â€º"})]})]})]}),G&&l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Order Details"}),e.jsx("button",{onClick:()=>O(!1),className:"text-gray-400 hover:text-gray-600 text-2xl leading-none",children:"Ã—"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Order Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Order ID:"})," ",l.id]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",l.date]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Amount:"})," ",A(l.amount)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Payment:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded text-xs ${j(l.orderStatus)}`,children:l.orderStatus})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Delivery:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded text-xs ${j(l.deliveryStatus)}`,children:l.deliveryStatus})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Customer Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",l.name]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",l.email]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"})," ",l.phone]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Method:"})," ",l.deliveryMethod]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Address:"})," ",l.address]})]})]})]}),((q=l.cart)==null?void 0:q.length)>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Order Items"}),e.jsx("div",{className:"space-y-2",children:l.cart.map((s,a)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.product_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Qty: ",s.ordered_quantity]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-semibold",children:A(s.product_price*s.ordered_quantity)})})]},a))})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>O(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:"Close"})})]})})]})};export{oe as default};
//# sourceMappingURL=OrdersPage-ClrM0_MY.js.map
